import{S as W,O as k,aB as I,k as M,j as b,an as _,i as S}from"./three.module-DpclfMcJ.js";import{d as z,r as n,f as O,u as T,g as B,j as t,c as U,C as q,T as V,a as y,G as N,h as X,b as Y}from"./CameraControls-DSY_Wd5L.js";import{u as Z,G as H,T as J}from"./leva.esm-DWiqsDYb.js";import{T as K}from"./TilesFadePlugin-CYp6zEtB.js";import{T as Q}from"./TileCompressionPlugin-LPgvgQPx.js";import{U as $}from"./UpdateOnChangePlugin-BFotcVNs.js";import{D as ee}from"./DRACOLoader-DJWREZh5.js";import{G as te}from"./GoogleCloudAuthPlugin-gv3hNYxX.js";import{c as re}from"./EnvironmentControls-CYEuz71t.js";import{C as oe}from"./CameraTransitionManager-6Raba0ko.js";import"./GlobeControls-tcF-lZFC.js";import"./Ellipsoid-Cnb0UTwk.js";import"./TilesRenderer-3GzfWA9Z.js";import"./I3DMLoader-BlebwdUJ.js";import"./readMagicBytes-Da5ueiou.js";import"./LoaderBase-CVSPpjX2.js";import"./GLTFLoader-DkJa3Jo5.js";import"./B3DMLoader-B2OeBq6-.js";import"./PNTSLoader-BMN5TswI.js";import"./CMPTLoader-nLXQ3OXQ.js";import"./GLTFExtensionLoader-TubLlshp.js";import"./EllipsoidRegion-D6hT1syi.js";import"./GLTFMeshFeaturesExtension-D473cUUw.js";import"./Pass-inUSP30K.js";const f=new M,C=new M,E=new M,v=new b,L=new b,w=new b,P=new _,R={};function ae(i,c,r,a){L.copy(r.matrixWorld).invert(),P.origin.copy(i.position),P.direction.set(0,0,-1).transformDirection(i.matrixWorld),P.applyMatrix4(L),re(P,c,E),E.applyMatrix4(r.matrixWorld),C.set(0,0,-1).transformDirection(i.matrixWorld);const l=E.sub(i.position).dot(C);return a.copy(i.position).addScaledVector(C,l),a}function ie(i){const{defaultScene:c,defaultCamera:r,overrideRenderLoop:a=!0,renderPriority:l=1}=i,m=n.useMemo(()=>new k,[]),[h,u,p,g]=z(s=>[s.set,s.size,s.gl,s.scene]);n.useEffect(()=>{h({camera:m})},[h,m]),n.useEffect(()=>{m.left=-u.width/2,m.right=u.width/2,m.top=u.height/2,m.bottom=-u.height/2,m.near=0,m.far=2e3,m.position.z=m.far/2,m.updateProjectionMatrix()},[m,u]),T(()=>{a&&p.render(c,r);const s=p.autoClear;p.autoClear=!1,p.clearDepth(),p.render(g,m),p.autoClear=s},l)}function G(){const i=n.useRef();return n.useEffect(()=>{const r=i.current.attributes.position;for(let a=0,l=r.count;a<l;a++)f.fromBufferAttribute(r,a),f.y>0&&(f.x=0,r.setXYZ(a,...f))}),t.jsx("boxGeometry",{ref:i})}function ne({northColor:i=15684432,southColor:c=16777215}){const[r,a]=n.useState(),l=n.useRef();return n.useEffect(()=>{a(l.current)},[]),t.jsxs("group",{scale:.5,ref:l,children:[t.jsx("ambientLight",{intensity:1}),t.jsx("directionalLight",{position:[0,2,3],intensity:3,target:r}),t.jsx("directionalLight",{position:[0,-2,-3],intensity:3,target:r}),t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{}),t.jsx("meshBasicMaterial",{color:0,opacity:.3,transparent:!0,side:I})]}),t.jsxs("group",{scale:[.5,1,.15],children:[t.jsxs("mesh",{"position-y":.5,children:[t.jsx(G,{}),t.jsx("meshStandardMaterial",{color:i})]}),t.jsxs("mesh",{"position-y":-.5,"rotation-x":Math.PI,children:[t.jsx(G,{}),t.jsx("meshStandardMaterial",{color:c})]})]})]})}function se({children:i,overrideRenderLoop:c,mode:r="3d",margin:a=10,scale:l=35,visible:m=!0,...h}){const[u,p,g]=z(e=>[e.camera,e.scene,e.size]),s=n.useContext(O),x=n.useRef(null),j=n.useMemo(()=>new W,[]);return T(()=>{if(s===null||x.current===null)return null;const{ellipsoid:e}=s,o=x.current;if(v.copy(s.group.matrixWorld).invert(),ae(u,e,s.group,E).applyMatrix4(v),e.getPositionToCartographic(E,R),e.getRotationMatrixFromAzElRoll(R.lat,R.lon,0,0,0,w).premultiply(s.group.matrixWorld),w.invert(),v.copy(u.matrixWorld).premultiply(w),r.toLowerCase()==="3d")o.quaternion.setFromRotationMatrix(v).invert();else if(f.set(0,1,0).transformDirection(v).normalize(),f.z=0,f.normalize(),f.length()===0)o.quaternion.identity();else{const d=C.set(0,1,0).angleTo(f);C.cross(f).normalize(),o.quaternion.setFromAxisAngle(C,-d)}}),i||(i=t.jsx(ne,{})),m?B(t.jsxs(t.Fragment,{children:[t.jsx("group",{ref:x,scale:l,position:[g.width/2-a-l/2,-g.height/2+a+l/2,0],...h,children:i}),t.jsx(ie,{defaultCamera:u,defaultScene:p,overrideRenderLoop:c,renderPriority:10})]}),j,{events:{priority:10}}):null}const ce=n.forwardRef(function(c,r){const{mode:a,onTransitionStart:l,onTransitionEnd:m,perspectiveCamera:h,orthographicCamera:u}=c,[p,g,s,x,j]=z(o=>[o.set,o.invalidate,o.controls,o.camera,o.size]),e=n.useMemo(()=>{const o=new oe;return o.autoSync=!1,x.isOrthographicCamera?(o.orthographicCamera.copy(x),o.mode="orthographic"):o.perspectiveCamera.copy(x),o.syncCameras(),o.mode=a,o},[]);n.useEffect(()=>{const{perspectiveCamera:o,orthographicCamera:d}=e,D=j.width/j.height;o.aspect=D,o.updateProjectionMatrix(),d.left=-d.top*D,d.right=-d.left,o.updateProjectionMatrix()},[e,j]),n.useEffect(()=>{r&&(r instanceof Function?r(e):r.current=e)},[e,r]),n.useEffect(()=>{const o=({camera:d})=>{p(()=>({camera:d}))};return p(()=>({camera:e.camera})),e.addEventListener("camera-change",o),()=>{e.removeEventListener("camera-change",o)}},[e,p]),n.useEffect(()=>{if(m)return e.addEventListener("transition-end",m),()=>e.removeEventListener("transition-end",m)},[m,e]),n.useEffect(()=>{if(l)return e.addEventListener("transition-start",l),()=>e.removeEventListener("transition-start",l)},[l,e]),n.useEffect(()=>{const o=e.perspectiveCamera,d=e.orthographicCamera;return e.perspectiveCamera=h||o,e.orthographicCamera=u||d,p(()=>({camera:e.camera})),()=>{e.perspectiveCamera=o,e.orthographicCamera=d}},[h,u,e,p]),n.useEffect(()=>{a!==e.mode&&(s&&s.isEnvironmentControls?(s.getPivotPoint(e.fixedPoint),e.syncCameras(),s.adjustCamera(e.perspectiveCamera),s.adjustCamera(e.orthographicCamera)):(e.fixedPoint.set(0,0,-1).transformDirection(e.camera.matrixWorld).multiplyScalar(50).add(e.camera.position),e.syncCameras()),e.toggle(),g())},[a,e,g,s]),T(()=>{e.update(),s&&(s.enabled=!e.animating),e.animating&&g()},-1)}),me=new ee().setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),A=new M,F=new M;function le(){const i=n.useRef();return T(({camera:c})=>{const r=i.current;A.setFromMatrixPosition(c.matrixWorld),r.position.set(0,0,0),r.updateMatrixWorld(),F.setFromMatrixPosition(r.matrixWorld);let a;if(c.isPerspectiveCamera){const l=A.distanceTo(F);a=Math.max(.05*l*Math.atan(c.fov*S.DEG2RAD),25)}else a=Math.max((c.top-c.bottom)*.05/c.zoom,25);r.scale.setScalar(a),r.position.z=a*.5}),t.jsxs("mesh",{ref:i,"rotation-x":-Math.PI/2,raycast:()=>{},children:[t.jsx("coneGeometry",{args:[.3]}),t.jsx("meshStandardMaterial",{color:15483002,emissive:15483002,emissiveIntensity:.25})]})}function pe(){const i={apiToken:{value:localStorage.getItem("google-token")||"put-your-api-key-here",onChange:a=>localStorage.setItem("google-token",a),transient:!1},ortho:!1},{apiToken:c,ortho:r}=Z(i);return t.jsxs(q,{camera:{position:[0,.5*1e7,1.5*1e7]},style:{width:"100%",height:"100%",position:"absolute",margin:0,left:0,top:0},flat:!0,children:[t.jsx("color",{attach:"background",args:[1118481]}),t.jsxs(V,{group:{rotation:[-Math.PI/2,0,0]},children:[t.jsx(y,{plugin:te,args:{apiToken:c}}),t.jsx(y,{plugin:H,dracoLoader:me}),t.jsx(y,{plugin:Q}),t.jsx(y,{plugin:$}),t.jsx(y,{plugin:K}),t.jsx(N,{enableDamping:!0}),t.jsx(J,{}),t.jsx(X,{lat:34.2013*S.DEG2RAD,lon:-118.1714*S.DEG2RAD,height:350,children:t.jsx(le,{})}),";",t.jsx(se,{})]},c),t.jsx(Y,{preset:"sunset",backgroundBlurriness:.9,environmentIntensity:1}),t.jsx(ce,{mode:r?"orthographic":"perspective"})]})}U(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(pe,{})}));
